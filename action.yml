name: Version Bump Workflow

on:
  pull_request:
    types: [closed]
    branches:
      - master
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  actions: write

jobs:
  version-bump:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Bump version
        id: version_bump
        uses: Justinjoseph18/version-bumber-action@v27
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          initial_version: ${{ secrets.INITIAL_VERSION }}
          force_initial: 'true'

      - name: Update version in secrets
        uses: gliech/create-github-secret-action@v1
        with:
          name: INITIAL_VERSION
          value: ${{ steps.version_bump.outputs.new_version }}
          pa_token: ${{ secrets.PAT }}
